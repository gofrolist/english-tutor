# Quickstart Guide: English Tutor Telegram Bot

**Created**: 2026-01-10  
**Feature**: English Tutor Telegram Bot  
**Phase**: Phase 1 - Design & Contracts

## Overview

This guide provides a quick start to understanding the English Tutor Telegram Bot architecture, key components, and development workflow.

## Architecture Summary

- **Platform**: Telegram Bot (backend service)
- **Framework**: FastAPI (Python 3.13)
- **Database**: Supabase (PostgreSQL) with SQLAlchemy ORM
- **Deployment**: fly.io (Docker containers, ghcr.io registry)
- **Content Management**: REST API (external, no redeployment required)

## Key Components

### 1. Telegram Bot Handler

- Handles user interactions via Telegram Bot API
- Processes commands, messages, and callbacks
- Delivers tasks based on user's English level
- Manages assessment quiz flow

### 2. Assessment Service

- Manages initial level assessment quiz
- Calculates scores and determines English level (A1-C2)
- Supports reassessment functionality
- Stores assessment history

### 3. Task Delivery Service

- Retrieves tasks appropriate to user's level
- Supports three content types: text, audio, video
- Delivers content via Telegram (text, audio messages, video links)
- Manages task completion and progress tracking

### 4. Content Management API

- REST API for content managers/tutors
- CRUD operations on tasks and questions
- Draft/published status workflow
- External interface (no bot interaction required)
- OpenAPI specification (auto-generated by FastAPI)

### 5. Progress Tracking Service

- Records user task completions
- Calculates scores and performance metrics
- Tracks user progress over time
- Supports level reassessment triggers

## Data Flow

### User Assessment Flow

1. User starts conversation with bot
2. Bot initiates assessment quiz
3. User answers questions
4. System calculates score and determines level
5. User level stored, tasks can now be delivered

### Task Delivery Flow

1. User requests a new task
2. System queries database for tasks matching user's level
3. Task selected (random or sequential)
4. Content delivered via Telegram (text/audio/video)
5. Questions presented to user
6. User submits answers
7. System records progress and provides feedback

### Content Management Flow

1. Content manager accesses REST API
2. Creates/updates task and questions via API
3. Content saved in draft status
4. Content manager reviews and publishes
5. Published content immediately available to users (within 5 minutes)

## Development Workflow

### Prerequisites

- Python 3.13
- Supabase (managed PostgreSQL)
- Telegram Bot Token (from @BotFather)
- uv (dependency management)

### Setup Steps

1. **Clone repository and checkout feature branch**:
   ```bash
   git checkout 001-english-tutor-bot
   cd backend
   ```

2. **Install dependencies**:
   ```bash
   uv sync
   ```

3. **Configure environment**:
   ```bash
   # Set environment variables
   export DATABASE_URL=postgresql://postgres:[PASSWORD]@[PROJECT_REF].supabase.co:5432/postgres
   # Or with connection pooler (recommended for production):
   # export DATABASE_URL=postgresql://postgres:[PASSWORD]@[PROJECT_REF].supabase.co:6543/postgres?pgbouncer=true
   export TELEGRAM_BOT_TOKEN=your_bot_token
   ```

4. **Run database migrations**:
   ```bash
   # After Alembic setup
   uv run alembic upgrade head
   ```

5. **Run tests**:
   ```bash
   uv run pytest
   ```

6. **Start development server**:
   ```bash
   uv run uvicorn main:app --reload --port 8080
   ```

### Code Structure

```
backend/
├── src/
│   ├── models/          # SQLAlchemy models (User, Task, Question, etc.)
│   ├── services/        # Business logic
│   │   ├── assessment.py
│   │   ├── task_delivery.py
│   │   └── progress.py
│   ├── api/             # FastAPI routes
│   │   ├── bot/         # Telegram bot handlers
│   │   └── content/     # Content management API
│   └── config.py        # Configuration
└── tests/
    ├── unit/            # Unit tests
    ├── integration/     # Integration tests
    └── contract/        # Contract tests
```

## Testing Strategy

- **Unit Tests**: Models and service functions
- **Integration Tests**: User journeys (assessment, task completion)
- **Contract Tests**: API endpoints (content management API)
- **Coverage**: Minimum 80% (enforced by pytest)

## Deployment

- **Platform**: fly.io
- **Container Registry**: ghcr.io
- **Database**: Supabase (managed PostgreSQL)
- **Process**: Docker build → Push to ghcr.io → Deploy to fly.io

## Key Design Decisions

1. **External Content Management**: REST API enables content updates without redeployment
2. **Database-backed Content**: All content stored in Supabase (PostgreSQL) (not hardcoded)
3. **Draft/Published Workflow**: Content review before publication
4. **Hierarchical Organization**: Content organized by level (A1-C2) and type (text/audio/video)
5. **Async/await**: FastAPI async patterns for Telegram Bot API integration

## Next Steps

1. Review [data-model.md](data-model.md) for entity details
2. Review [contracts/openapi.yaml](contracts/openapi.yaml) for API specification
3. Run `/speckit.tasks` to generate implementation tasks
4. Begin implementation following TDD workflow
